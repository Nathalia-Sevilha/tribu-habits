<div class="habits-container">
  <!-- Header -->
  <div class="header">
    <h1>Hello <%= current_user.username %>! ðŸ‘‹</h1>
    <div class="date"><%= Date.today.strftime("%A, %B %d, %Y") %></div>
    <!-- Day Buttons -->
    <div data-controller="weekdays" class="mt-3 d-flex justify-content-between">
      <% Day.all.each_with_index do |day, index| %>
        <button data-weekdays-target="button"
          data-action="click->weekdays#changeDay"
          data-day-name="<%= day.name %>"
          class="day-default <%= 'active' if day.name == @day.name %>">
          <%= "#{index + 1} <br> <span class='day-letters'>#{day.name.slice(0,3).upcase}</span>".html_safe %>
        </button>
      <% end %>
    </div>
  </div>
  <!-- Progress Card -->
  <turbo-frame id="habits-list">
  <div class="progress-card mb-4">
    <h5 class="mb-4">Your daily progress</h5>
    <div class="progress-bar-container">
      <div id="progress-bar" class="progress-bar" style="width: <%= @completion_percentage %>%;"></div>
    </div>
    <% if @total_count > 0 %>
      <p class="h6 fw-normal" style="color: var(--community-text-color);"><%= @completed_count %> / <%= @total_count %> completed</p>
      <p>
        <% if @completed_count >= @total_count %>
          Well done! All habits completed! ðŸŽ‰
        <% end %>
      </p>
    <% else %>
      <p>No habits for today.</p>
    <% end %>
  </div>
   <!-- Title / View all btn -->
    <div class="d-flex justify-content-between align-items-center mb-3">
    <!-- if we are in today day, title : Today's Habits, elsif day before today ,title : Yesterday's Habits..., elsif day after today , title : Tomorrow's Habits... else, title : Thrusday's Habits... -->
      <h5 class="mb-0">
        <% if @day == Day.find_by(name: Date.today.strftime("%A")) %>
          Today's Habits
        <% elsif @day == Day.find_by(name: (Date.today - 1).strftime("%A")) %>
          Yesterday's Habits
        <% elsif @day == Day.find_by(name: (Date.today + 1).strftime("%A")) %>
          Tomorrow's Habits
        <% else %>
          <%= @day.name %>'s Habits
        <% end %>
      </h5>
      <div>
      <%= link_to view_all_habits_path, id: "link-view-all", data: { turbo: false } do %>
        View All
      <i class="fas fa-chevron-right ml-1"></i>
      <% end %>
      </div>
    </div>
    <!-- Habits List -->
    <ul class="habits-list">
      <% @habits.each do |habit| %>
        <li class="habit-item">
          <div class="habit-card" style="--habit-color: #<%= habit.color %>CC">
            <%= link_to "", habit_path(habit), class: "card-link", data: { turbo: false } %>
            <div class="habit-card-content d-flex align-items-center justify-content-between">
              <h3 class="habit-card-title mb-0"><%= habit.title %></h3>
              <div class="habit-streak d-flex align-items-center mt-0">
                <i class="fas fa-fire"></i>
                <%= habit.streak %>
              </div>
            </div>
          </div>

          <!-- Checkbox -->
          <div class="checkbox-container">
            <%= form_with url: toggle_done_habits_path, method: :patch, data: { turbo_frame: "habits-list" } do |f| %>
              <%= hidden_field_tag :habit_id, habit.id %>
              <%= hidden_field_tag :day_id, @day.id %>
              <%= check_box_tag :done, 1,
                      DayHabit.exists?(habit: habit, day: @day, done: true),
                      onchange: 'this.form.submit();',
                      id: "habit-#{habit.id}",
                       class: "checkbox-input"%>
            <% end %>
          </div>
        </li>
      <% end %>
    </ul>
  </turbo-frame>
</div>
