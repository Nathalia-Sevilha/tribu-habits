<% role =
     if message.respond_to?(:role) && message.role.present?
       message.role
     elsif message.respond_to?(:user_id) && message.user_id.present?
       "user"
     else
       "assistant"
     end
%>

<div class="message-row <%= role %>">
<div class="avatar">
  <% if role == "user" %>
    <%= image_tag message.chat.user.photo.attached? ? url_for(message.chat.user.photo) : "user.svg",
                  class: "w-100 h-100 object-fit-cover", alt: "You" %>
  <% else %>
    <%= image_tag "stars.svg", class: "ai-comments-img", alt: "AI" %>
  <% end %>
</div>


  <div class="bubble card_style_chat">
    <div class="content" style="color: var(--community-text-color);">
      <%= simple_format(message.content.to_s) %>
    </div>
    <div class="meta">
      <small class="text-muted"><%= time_ago_in_words(message.created_at) %> ago</small>
    </div>
  </div>
</div>
